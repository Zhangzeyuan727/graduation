{"remainingRequest":"/Users/zzy/Desktop/zzy/node_modules/_babel-loader@8.0.4@babel-loader/lib/index.js!/Users/zzy/Desktop/zzy/node_modules/_cache-loader@1.2.5@cache-loader/dist/cjs.js??ref--0-0!/Users/zzy/Desktop/zzy/node_modules/_vue-loader@15.4.2@vue-loader/lib/index.js??vue-loader-options!/Users/zzy/Desktop/zzy/src/views/bookDetail/bookDetail.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/zzy/Desktop/zzy/src/views/bookDetail/bookDetail.vue","mtime":1544079052000},{"path":"/Users/zzy/Desktop/zzy/node_modules/_cache-loader@1.2.5@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zzy/Desktop/zzy/node_modules/_babel-loader@8.0.4@babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/zzy/Desktop/zzy/node_modules/_cache-loader@1.2.5@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zzy/Desktop/zzy/node_modules/_vue-loader@15.4.2@vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.regexp.constructor\";\nimport \"core-js/modules/es6.regexp.replace\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.array.for-each\";\nimport \"core-js/modules/es6.number.constructor\";\nimport \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"/Users/zzy/Desktop/zzy/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nexport default {\n  data: function data() {\n    return {\n      active: 'content',\n      value: 0,\n      showReview: false,\n      reviewValue: null,\n      reviewTitle: '',\n      reviewContent: '',\n      bookDetail: [],\n      bookReview: [],\n      //收藏列表\n      collectList: []\n    };\n  },\n  created: function created() {\n    var id = localStorage.getItem('bookDetailId');\n    this.loadData(id);\n  },\n  methods: {\n    back: function back() {\n      this.$router.back();\n    },\n    change: function change(e) {\n      this.active = e;\n    },\n    loadData: function () {\n      var _loadData = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee(id) {\n        var _this = this;\n\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return this.$http.queryBookById(\"id=\" + id).then(function (res) {\n                  if (res.data.statusCode === 1) {\n                    _this.bookDetail = res.data.results;\n                    _this.value = Number(parseFloat(_this.bookDetail[0].score - 5).toFixed(1));\n                  }\n                });\n\n              case 2:\n                _context.next = 4;\n                return this.$http.queryReviewByBook(\"book_id=\" + id + \"&pagination=false\").then(function (res) {\n                  if (res.data.statusCode === 1) {\n                    _this.bookReview = res.data.results;\n\n                    _this.bookReview.forEach(function (item) {\n                      _this.$set(item, 'time', _this.dateFormat(item.created_at, 'yyyy-mm-dd HH:MM:SS'));\n                    });\n                  }\n                });\n\n              case 4:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function loadData(_x) {\n        return _loadData.apply(this, arguments);\n      }\n\n      return loadData;\n    }(),\n    //提交评论\n    goCommit: function goCommit() {\n      var _this2 = this;\n\n      this.$http.getUserInfo({\n        book_id: this.bookDetail[0].id,\n        title: this.reviewTitle,\n        star: this.reviewValue,\n        content: this.reviewContent\n      }).then(function (res) {\n        if (res.data.statusCode == 1) {\n          _this2.$toast({\n            message: '评论成功'\n          });\n\n          setTimeout(function () {\n            _this2.showReview = false;\n          }, 3000);\n        }\n      });\n    },\n    //评论\n    goReview: function goReview() {\n      var userInfo = JSON.parse(localStorage.getItem('userInfo'));\n\n      if (userInfo) {\n        this.$store.commit(\"addToken\", userInfo.uid);\n        this.showReview = true;\n      } else {\n        this.$router.push({\n          path: \"/login\",\n          query: {\n            from: \"/bookDetail\"\n          }\n        });\n      }\n    },\n    //收藏\n    // goCollect(){\n    // let collect =JSON.parse(localStorage.getItem('collect'));\n    // if(collect){\n    // }else{\n    //   localStorage.setItem('collect',JSON.stringify(this.bookDetail[0]))\n    // }\n    // },\n    //改变时间格式\n    dateFormat: function dateFormat(date, fmt) {\n      if (date === null || date === \"\") {\n        return \"\";\n      }\n\n      date = new Date(date);\n      var o = {\n        \"m+\": date.getMonth() + 1,\n        \"d+\": date.getDate(),\n        \"H+\": date.getHours(),\n        \"M+\": date.getMinutes(),\n        \"S+\": date.getSeconds(),\n        \"q+\": Math.floor((date.getMonth() + 3) / 3),\n        S: date.getMilliseconds()\n      };\n\n      if (/(y+)/.test(fmt)) {\n        fmt = fmt.replace(RegExp.$1, (date.getFullYear() + \"\").substr(4 - RegExp.$1.length));\n      }\n\n      for (var k in o) {\n        if (new RegExp(\"(\" + k + \")\").test(fmt)) fmt = fmt.replace(RegExp.$1, RegExp.$1.length == 1 ? o[k] : (\"00\" + o[k]).substr((\"\" + o[k]).length));\n      }\n\n      return fmt;\n    }\n  }\n};",{"version":3,"sources":["bookDetail.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n    <div id=\"bookDetail\">\n        <div class=\"header\" v-for=\"item in bookDetail\" v-bind:key=\"item.name\">\n            <i @click=\"back\" class=\"iconfont icon-25\"></i>\n            <p>{{item.name}}</p>\n        </div>\n        <div class=\"content\" v-for=\"item in bookDetail\" v-bind:key=\"item.id\">\n            <div class=\"bookInfo\">\n                <img src=\"../.././assets/bookImg/book-1.jpg\" />\n                <div class=\"info\">\n                    <p>书名：<span>{{item.name}}</span></p>\n                    <p>作者：<span>{{item.author.name}}</span></p>\n                    <p>出版社：<span>{{item.publishingFirm}}</span></p>\n                    <p>价格：<span>{{item.price}}</span></p>\n                    <p>页数：<span>{{item.pagecount}}</span></p>\n                    <p>装帧：<span>{{item.binding}}</span></p>\n                    <p>ISBN：<span>{{item.isbn}}</span></p>\n                </div>\n            </div>\n            <div class=\"descriptionTitle\">\n                <div @click=\"change('content')\" :class=\"{isActived:active=='content'}\">内容简介</div>\n                <div @click=\"change('author')\" :class=\"{isActived:active=='author'}\">作者简介</div>\n            </div>\n            <mt-tab-container v-model=\"active\" :swipeable=\"true\">\n              <mt-tab-container-item id=\"content\">\n                <P class=\"descriptionCon\">{{item.description}}</p>\n              </mt-tab-container-item>\n              <mt-tab-container-item id=\"author\">\n                <P class=\"descriptionCon\">{{item.author.description}}</p>\n              </mt-tab-container-item>\n            </mt-tab-container>  \n            <div class=\"description\">\n                <div class=\"title\">评分&评论</div>\n                <div class=\"score\" v-for=\"item in bookDetail\" v-bind:key=\"item.score\">\n                    <el-rate v-model=\"value\" disabled show-score text-color=\"#999\" score-template=\"{value}\"></el-rate>\n                </div>\n                <div class=\"review\">\n                    <div v-for=\"(reviewItem,index) in bookReview\" :key=\"index\">\n                      <div class=\"reviewTitle\">\n                        <img v-if=\"reviewItem.user_id==1\" src=\"../../assets/bookImg/reviewer1.jpg\" alt=\"\">\n                        <img v-else src=\"../../assets/bookImg/reviewer2.jpg\" alt=\"\">\n                        <span v-if=\"reviewItem.user\">{{reviewItem.user.name}}</span>\n                        <el-rate v-model=\"reviewItem.star\"  disabled  text-color=\"#999\" ></el-rate>\n                        <span class=\"reviewTime\">{{reviewItem.time}}</span>\n                      </div>\n                      <div v-if=\"reviewItem.title\">{{reviewItem.title}}</div>\n                      <div v-if=\"reviewItem.content\" class=\"reviewContent\" style=\"font-size:10px\">{{reviewItem.content}}</div>\n                    </div>\n                </div>\n                <!-- <div style=\"position:fixed;left:0;bottom:10vh; color:red\" @click=\"goCollect\">收藏</div> -->\n                <div class=\"myReview\">\n                  <div @click=\"goReview\">我要评论</div>\n                    <div v-if=\"showReview\">\n                      <el-input v-model=\"reviewTitle\" placeholder=\"请输入评论标题\"></el-input>\n                      <p>评价等级</p>\n                      <el-rate v-model=\"reviewValue\"></el-rate>\n                      <el-input type=\"textarea\" :rows=\"2\" placeholder=\"请输入评论内容\" v-model=\"reviewContent\"></el-input>\n                      <div @click=\"goCommit\">确认提交</div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      active:'content',\n      value: 0,\n      showReview:false,\n      reviewValue:null,\n      reviewTitle:'',\n      reviewContent:'',\n      bookDetail: [],\n      bookReview: [],\n      //收藏列表\n      collectList:[]\n    };\n  },\n  created() {\n    let id=localStorage.getItem('bookDetailId');\n    this.loadData(id);\n  },\n  methods: {\n    back () {\n      this.$router.back();\n    },\n    change(e){\n        this.active=e;\n    },\n    async loadData (id) {\n     await this.$http\n      .queryBookById(\"id=\" + id)\n      .then(res => {\n        if (res.data.statusCode === 1) {\n          this.bookDetail = res.data.results;\n          this.value = Number(parseFloat(this.bookDetail[0].score - 5).toFixed(1));\n        }\n      });\n      //获取书评\n      await this.$http\n      .queryReviewByBook(\"book_id=\" + id+\"&pagination=false\")\n      .then(res => {\n        if (res.data.statusCode === 1) {\n          this.bookReview = res.data.results;\n          this.bookReview.forEach(item=>{\n            this.$set(item,'time',this.dateFormat(item.created_at,'yyyy-mm-dd HH:MM:SS'));\n          })\n        }\n      });\n    },\n    //提交评论\n    goCommit(){\n         this.$http.getUserInfo({\n          book_id:this.bookDetail[0].id,\n          title:this.reviewTitle,\n          star:this.reviewValue,\n          content:this.reviewContent\n        }).then(res=>{\n          if(res.data.statusCode==1){\n            this.$toast({\n              message: '评论成功'\n            });\n            setTimeout(()=>{\n              this.showReview=false\n            },3000)\n          }\n        })\n    },\n    //评论\n    goReview(){\n      let userInfo=JSON.parse(localStorage.getItem('userInfo'));\n      if(userInfo){\n        this.$store.commit(\"addToken\",userInfo.uid)\n        this.showReview=true;\n      }else{\n         this.$router.push({ path: \"/login\", query: { from: \"/bookDetail\" } });\n      }\n    },\n    //收藏\n    // goCollect(){\n      // let collect =JSON.parse(localStorage.getItem('collect'));\n      // if(collect){\n\n      // }else{\n      //   localStorage.setItem('collect',JSON.stringify(this.bookDetail[0]))\n      // }\n    // },\n  //改变时间格式\n  dateFormat(date, fmt) {\n  if (date === null || date === \"\") {\n    return \"\";\n  }\n  date = new Date(date);\n\n  var o = {\n    \"m+\": date.getMonth() + 1,\n    \"d+\": date.getDate(),\n    \"H+\": date.getHours(),\n    \"M+\": date.getMinutes(),\n    \"S+\": date.getSeconds(),\n    \"q+\": Math.floor((date.getMonth() + 3) / 3),\n    S: date.getMilliseconds()\n  };\n  if (/(y+)/.test(fmt)) {\n    fmt = fmt.replace(\n      RegExp.$1,\n      (date.getFullYear() + \"\").substr(4 - RegExp.$1.length)\n    );\n  }\n  for (var k in o) {\n    if (new RegExp(\"(\" + k + \")\").test(fmt))\n      fmt = fmt.replace(\n        RegExp.$1,\n        RegExp.$1.length == 1 ? o[k] : (\"00\" + o[k]).substr((\"\" + o[k]).length)\n      );\n  }\n  return fmt;\n}\n\n  }\n};\n</script>\n\n<style lang=\"scss\">\n#bookDetail {\n  position: absolute;\n  left: 0;\n  right: 0;\n  top: 0;\n  bottom: 0px;\n  overflow: hidden;\n  width: 100%;\n  z-index: 100;\n  background-color: #fff;\n  .header {\n    display: flex;\n    align-items: center;\n    width: 100%;\n    height: 48px;\n    background-color: #bbd2c2;\n    color: white;\n    font-size: 15px;\n    .icon-25 {\n      font-size: 20px;\n      padding: 0 12px;\n    }\n    p {\n      width: 100%;\n      text-align: center;\n      margin-right: 44px;\n    }\n  }\n  .content {\n    width: 100%;\n    position: absolute;\n    left: 0;\n    right: 0;\n    top: 48px;\n    bottom: 0px;\n    overflow-x: hidden;\n    overflow-y: scroll;\n    // background-color: #f1f1f1;\n    .isActived{\n      background-color: #bbd2c2;\n    }\n    .descriptionTitle{\n      height: 36px;\n      box-sizing: border-box;\n      border-bottom: 1px solid #ccc;\n      border-top: 1px solid #ccc;\n      background-color: #f1f1f1;\n      display: flex;\n      align-items: center;\n      >div{\n        color: #333;\n        height: 100%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 12px;\n        flex: 1;\n      }\n    }\n    .descriptionCon{\n         margin: 10px 10px;\n        font-size: 12px;\n        color: #666;\n      }\n    .bookInfo {\n      display: flex;\n      justify-content: flex-start;\n      align-items: center;\n      img {\n        width: 100px;\n        margin: 10px;\n      }\n      .info {\n        margin-right: 10px;\n        p {\n          color: #333;\n          font-size: 14px;\n          span {\n            color: #666;\n          }\n        }\n      }\n    }\n    .description {\n      width: 100%;\n      .title {\n        width: 100%;\n        height: 36px;\n        line-height: 36px;\n        background-color: #f1f1f1;\n        color: #333;\n        padding-left: 10px;\n        font-size: 14px;\n        border-top: 1px solid #ccc;\n        border-bottom: 1px solid #ccc;\n      }\n      p {\n        margin: 10px 10px;\n        font-size: 12px;\n        color: #666;\n      }\n      .score {\n        margin: 10px;\n      }\n      .review{\n        width: 100%;\n        >div{\n          margin: 0 10px;\n          width: calc(100% - 20px);\n            .reviewTitle{\n              display: flex;\n              height: 40px;\n              align-items: center;\n              img{\n                width: 20px;\n              }\n              .reviewTime{\n                font-size: 12px;\n              }\n            }\n            .reviewContent{\n                width:100%;\n                display:-webkit-box; \n                overflow:hidden;\n                text-overflow:ellipsis; \n                -webkit-box-orient:vertical; //子元素应该被水平或垂直排列\n                -webkit-line-clamp:3;  //3行后显示省略号\n              }\n        }\n      }\n      .myReview{\n        padding: 0 10px;\n        box-sizing: border-box;\n        >div:first-child{\n          height: 30px;\n          line-height: 30px;\n          font-size: 12px;\n        }\n      }\n    }\n  }\n}\n</style>\n\n\n"],"sourceRoot":"src/views/bookDetail"}]}